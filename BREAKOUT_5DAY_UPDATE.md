# 破底翻偵測更新：改為五日內顯示

## ✅ 更新完成

已將破底翻偵測從「只顯示當日」改為「顯示五日內」的事件。

---

## 📝 更新內容

### 修改的檔案

#### 1. [main.py](main.py:176-197)
```python
# 修改前：只保留今日收回的事件
today_events = events[events['reclaim_date'].dt.date == today_tpe]

# 修改後：保留五日內收回的事件
five_days_ago = today_tpe - timedelta(days=5)
recent_events = events[events['reclaim_date'].dt.date >= five_days_ago]
```

**額外改進**：
- 按收回日期排序（最新的在前）
- 日誌訊息更新為「五日內破底翻股票」

#### 2. [modules/html_generator.py](modules/html_generator.py:292-317)
- 標題改為「破底翻型態 (五日內)」
- 顯示收回日期：`收回: 01/06 (5.00%)`
- 保持紅色配色方案

---

## 🎯 更新理由

### 為什麼選擇「五日」？

1. **涵蓋週末** ✅
   - 週五的破底翻可以在週一看到
   - 不會因為週末而錯過訊號

2. **更大的操作窗口** ✅
   - 不用當天就決定
   - 有時間觀察後續走勢

3. **避免訊號消失** ✅
   - 原本當日顯示，隔天就消失
   - 現在可以持續追蹤 5 天

4. **符合實務操作** ✅
   - 破底翻收回後通常還會持續觀察幾天
   - 5 天是合理的觀察期

---

## 📊 顯示範例

### GitHub Pages 效果

```
🔥 破底翻型態 (五日內)

┌─────────────────────┐
│ 3034 聯詠           │
│ 收回: 01/06 (5.00%) │ ← 顯示收回日期和幅度
└─────────────────────┘

┌─────────────────────┐
│ 2886 兆豐金         │
│ 收回: 11/20 (1.80%) │
└─────────────────────┘

┌─────────────────────┐
│ 2002 中鋼           │
│ 收回: 11/06 (1.96%) │
└─────────────────────┘
```

### 時間軸說明

假設今天是 **2026-01-28**（週二）

| 收回日期 | 距今 | 是否顯示 |
|---------|------|---------|
| 2026-01-28 (二) | 0天 | ✅ **顯示** |
| 2026-01-27 (一) | 1天 | ✅ **顯示** |
| 2026-01-24 (五) | 4天 | ✅ **顯示** |
| 2026-01-23 (四) | 5天 | ✅ **顯示** (邊界) |
| 2026-01-22 (三) | 6天 | ❌ 不顯示 |

---

## 🔄 排序邏輯

破底翻股票按**收回日期降序**排列：
- 最新收回的顯示在最上面
- 較舊的（但仍在5天內）顯示在下面

範例：
```
1. 3034 - 收回: 01/28 (今天)
2. 2886 - 收回: 01/27 (昨天)
3. 2002 - 收回: 01/24 (4天前)
```

---

## 💡 優點分析

### 對比原方案（只顯示當日）

| 特性 | 只顯示當日 | 顯示五日內 |
|------|-----------|-----------|
| **覆蓋週末** | ❌ 週五訊號週一消失 | ✅ 可持續到週三 |
| **操作時間** | ⚠️ 必須當天決定 | ✅ 有5天觀察期 |
| **訊號數量** | ⚠️ 較少（0-2個/天） | ✅ 較多（5-10個） |
| **實用性** | ⚠️ 容易錯過 | ✅ 更符合實務 |

### 潛在問題與解決

❓ **會不會太多股票？**
- 五日內通常 5-10 個事件
- 按日期排序，新的在前
- 仍在可控範圍

❓ **會不會太舊？**
- 5 天是合理的短期區間
- 顯示收回日期，用戶可自行判斷
- 可隨時調整天數（改 `timedelta(days=5)`）

---

## ⚙️ 如何調整天數

如果覺得 5 天太長或太短，可以修改 [main.py:179](main.py:179)：

```python
# 顯示 3 天內
five_days_ago = today_tpe - timedelta(days=3)

# 顯示 7 天內
five_days_ago = today_tpe - timedelta(days=7)

# 顯示當週（週一到今天）
from datetime import datetime
week_start = today_tpe - timedelta(days=today_tpe.weekday())
recent_events = events[events['reclaim_date'].dt.date >= week_start]
```

---

## 🧪 測試結果

### 測試執行
```bash
python test_integration.py
```

### 測試通過 ✅
- ✅ 偵測到 3 個破底翻事件（歷史資料）
- ✅ HTML 正確顯示「五日內」標題
- ✅ 顯示收回日期（月/日格式）
- ✅ 顯示收回幅度百分比
- ✅ 按日期排序正確

---

## 📈 實際應用範例

### 週五部署，週一查看

**週五 (01/24)** 執行 main.py：
- 發現 3034 當日收回

**週六-日**：
- GitHub Actions 不執行（週末休市）

**週一 (01/27)** 執行 main.py：
- 發現 2886 當日收回
- **仍顯示** 3034（01/24 收回，距今 3 天）

**結果**：
- 週一看到 2 支股票（3034 + 2886）
- 不會因為週末而錯過週五的訊號

---

## 📝 更新檢查清單

- [x] 修改過濾邏輯（五日內）
- [x] 更新 HTML 標題
- [x] 顯示收回日期
- [x] 按日期排序
- [x] 更新日誌訊息
- [x] 測試通過
- [x] 文件更新

---

## 🚀 部署

更新已完成，可以直接使用：

```bash
# 本地測試
python main.py

# 提交到 GitHub
git add .
git commit -m "🔄 破底翻偵測改為五日內顯示"
git push
```

GitHub Actions 會自動部署，每日 GitHub Pages 會顯示**五日內**的破底翻股票！

---

## 💬 建議

### 如果發現問題

1. **訊號太多**：改為 3 天
2. **訊號太少**：改為 7 天
3. **需要當日版本**：改回 `today_tpe` 過濾

### 進階應用

可以考慮：
- 顯示「新」標籤給當日收回的
- 按收回幅度排序（大的在前）
- 增加「距今天數」提示

---

完成！現在你的 GitHub Pages 會顯示五日內的破底翻股票，更實用、更人性化！🎉
